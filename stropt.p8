pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
room_square={}
rooms={room_square}

str="1,0,0,1,1,3,0,0"
f={
 t=room_square,
 links={
   {dcx=0,dcy=0,dir=d_down,trx=1,try=3,tcx=0,tcy=0,},
 },
}

atofp_params={"dcx","dcy","dir","trx","try","tcx","tcy"}
function atofp_small(s)
 local t,links=split(s),{}
 for i=2,#t,7 do
  local link={}
  for idx=0,6 do
   link[atofp_params[idx+1]]=tonum(t[i+idx])
  end
  add(links,link)
 end
 return {
  t=rooms[tonum(t[0])],
  links=links,
 }
end

function atofp(s)
 local t,links=split(s),{}
 for i=2,#t,7 do
  add(links,{
   dcx=tonum(t[i]),
   dcy=tonum(t[i+1]),
   dir=tonum(t[i+2]),
   trx=tonum(t[i+3]),
   try=tonum(t[i+4]),
   tcx=tonum(t[i+5]),
   tcy=tonum(t[i+6]),
  })
 end
 return {
  t=rooms[tonum(t[0])],
  links=links,
 }
end

?#atofp(str).links
?#atofp_small(str).links
__gfx__
00000000667776660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000670007660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700700700760000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000707770760000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000700700760000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700670007660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000667776660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
